"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[325],{285:(t,e,s)=>{s.d(e,{$:()=>u});var r=s(5155);s(2115);var a=s(4624),i=s(2085),n=s(9434);let o=(0,i.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function u(t){let{className:e,variant:s,size:i,asChild:u=!1,...c}=t,l=u?a.DX:"button";return(0,r.jsx)(l,{"data-slot":"button",className:(0,n.cn)(o({variant:s,size:i,className:e})),...c})}},1154:(t,e,s)=>{s.d(e,{A:()=>r});let r=(0,s(9946).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},2919:(t,e,s)=>{s.d(e,{A:()=>r});let r=(0,s(9946).A)("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]])},3227:(t,e,s)=>{s.d(e,{A:()=>r});let r=(0,s(9946).A)("building-2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]])},4560:(t,e,s)=>{s.d(e,{$:()=>o,s:()=>n});var r=s(7165),a=s(7948),i=s(6784),n=class extends a.k{#t;#e;#s;constructor(t){super(),this.mutationId=t.mutationId,this.#e=t.mutationCache,this.#t=[],this.state=t.state||o(),this.setOptions(t.options),this.scheduleGc()}setOptions(t){this.options=t,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(t){this.#t.includes(t)||(this.#t.push(t),this.clearGcTimeout(),this.#e.notify({type:"observerAdded",mutation:this,observer:t}))}removeObserver(t){this.#t=this.#t.filter(e=>e!==t),this.scheduleGc(),this.#e.notify({type:"observerRemoved",mutation:this,observer:t})}optionalRemove(){this.#t.length||("pending"===this.state.status?this.scheduleGc():this.#e.remove(this))}continue(){return this.#s?.continue()??this.execute(this.state.variables)}async execute(t){let e=()=>{this.#r({type:"continue"})};this.#s=(0,i.II)({fn:()=>this.options.mutationFn?this.options.mutationFn(t):Promise.reject(Error("No mutationFn found")),onFail:(t,e)=>{this.#r({type:"failed",failureCount:t,error:e})},onPause:()=>{this.#r({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#e.canRun(this)});let s="pending"===this.state.status,r=!this.#s.canStart();try{if(s)e();else{this.#r({type:"pending",variables:t,isPaused:r}),await this.#e.config.onMutate?.(t,this);let e=await this.options.onMutate?.(t);e!==this.state.context&&this.#r({type:"pending",context:e,variables:t,isPaused:r})}let a=await this.#s.start();return await this.#e.config.onSuccess?.(a,t,this.state.context,this),await this.options.onSuccess?.(a,t,this.state.context),await this.#e.config.onSettled?.(a,null,this.state.variables,this.state.context,this),await this.options.onSettled?.(a,null,t,this.state.context),this.#r({type:"success",data:a}),a}catch(e){try{throw await this.#e.config.onError?.(e,t,this.state.context,this),await this.options.onError?.(e,t,this.state.context),await this.#e.config.onSettled?.(void 0,e,this.state.variables,this.state.context,this),await this.options.onSettled?.(void 0,e,t,this.state.context),e}finally{this.#r({type:"error",error:e})}}finally{this.#e.runNext(this)}}#r(t){this.state=(e=>{switch(t.type){case"failed":return{...e,failureCount:t.failureCount,failureReason:t.error};case"pause":return{...e,isPaused:!0};case"continue":return{...e,isPaused:!1};case"pending":return{...e,context:t.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:t.isPaused,status:"pending",variables:t.variables,submittedAt:Date.now()};case"success":return{...e,data:t.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...e,data:void 0,error:t.error,failureCount:e.failureCount+1,failureReason:t.error,isPaused:!1,status:"error"}}})(this.state),r.jG.batch(()=>{this.#t.forEach(e=>{e.onMutationUpdate(t)}),this.#e.notify({mutation:this,type:"updated",action:t})})}};function o(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}},6681:(t,e,s)=>{s.d(e,{A:()=>i});var r=s(2115),a=s(7283);let i=()=>{let[t,e]=(0,r.useState)(!1),[s,i]=(0,r.useState)(null),[n,o]=(0,r.useState)(null),[u,c]=(0,r.useState)(!0),[l,h]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{h(!0);try{let t=localStorage.getItem("access_token"),s=localStorage.getItem("user");if(t&&(o(t),e(!0),a.A.setAuthToken(t),s))try{i(JSON.parse(s))}catch(t){console.error("Failed to parse stored user data:",t),localStorage.removeItem("user")}}catch(t){console.warn("localStorage not available:",t)}c(!1)},[]),l)?{isLoggedIn:t,user:s,token:n,loading:u,login:async(t,s)=>{try{let r=await fetch("/api/v1/users/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:t,password:s})});if(!r.ok)throw Error("ログインに失敗しました");let n=(await r.json()).access_token;localStorage.setItem("access_token",n),o(n),e(!0),a.A.setAuthToken(n);let u={id:1,name:t.split("@")[0],email:t,roles:["admin"]};return localStorage.setItem("user",JSON.stringify(u)),i(u),{success:!0}}catch(t){return console.error("Login error:",t),{success:!1,error:t instanceof Error?t.message:"ログインに失敗しました"}}},logout:()=>{localStorage.removeItem("access_token"),localStorage.removeItem("user"),o(null),i(null),e(!1),a.A.clearAuthToken()}}:{isLoggedIn:!1,user:null,token:null,loading:!0,login:async()=>({success:!1,error:"Not hydrated"}),logout:()=>{}}}},6695:(t,e,s)=>{s.d(e,{BT:()=>u,Wu:()=>c,ZB:()=>o,Zp:()=>i,aR:()=>n,wL:()=>l});var r=s(5155);s(2115);var a=s(9434);function i(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card",className:(0,a.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",e),...s})}function n(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card-header",className:(0,a.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...s})}function o(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card-title",className:(0,a.cn)("leading-none font-semibold",e),...s})}function u(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card-description",className:(0,a.cn)("text-muted-foreground text-sm",e),...s})}function c(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card-content",className:(0,a.cn)("px-6",e),...s})}function l(t){let{className:e,...s}=t;return(0,r.jsx)("div",{"data-slot":"card-footer",className:(0,a.cn)("flex items-center px-6 [.border-t]:pt-6",e),...s})}},7283:(t,e,s)=>{s.d(e,{A:()=>a});class r{async request(t,e,s){let r="".concat(this.baseUrl).concat(e);this.updateAuthToken();let a={method:t,headers:{...this.headers}};s&&(a.body=JSON.stringify(s));try{let t=await fetch(r,a);if(!t.ok)throw Error("API Error: ".concat(t.status," ").concat(t.statusText));let e=t.headers.get("content-type");if(e&&e.includes("application/json"))return t.json();return t.text()}catch(t){throw console.error("API Request failed:",t),t}}async get(t){return this.request("GET",t)}async post(t,e){return this.request("POST",t,e)}async put(t,e){return this.request("PUT",t,e)}async delete(t){return this.request("DELETE",t)}updateAuthToken(){if("undefined"!=typeof localStorage)try{let t=localStorage.getItem("access_token");t?this.headers.Authorization="Bearer ".concat(t):delete this.headers.Authorization}catch(t){console.warn("Could not access localStorage:",t),delete this.headers.Authorization}}setAuthToken(t){this.headers.Authorization="Bearer ".concat(t)}clearAuthToken(){delete this.headers.Authorization}constructor(t){this.baseUrl=t,this.headers={"Content-Type":"application/json",Accept:"application/json"}}}let a=new r("https://winyx.jp")},8497:(t,e,s)=>{s.d(e,{S:()=>a});var r=s(6681);let a=()=>{let{user:t,isLoggedIn:e}=(0,r.A)();return{isAdmin:()=>!!e&&!!t&&!!t.roles&&t.roles.includes("admin"),hasRole:s=>!!e&&!!t&&!!t.roles&&t.roles.includes(s),hasAnyRole:s=>!!e&&!!t&&!!t.roles&&s.some(e=>t.roles.includes(e)),hasAllRoles:s=>!!e&&!!t&&!!t.roles&&s.every(e=>t.roles.includes(e)),getPermissionErrorMessage:t=>e?t?"このページにアクセスするには「".concat(t,"」権限が必要です。"):"このページにアクセスする権限がありません。":"このページにアクセスするにはログインが必要です。",userRoles:(null==t?void 0:t.roles)||[]}}},8860:(t,e,s)=>{s.d(e,{LT:()=>x,sL:()=>v,q$:()=>f,dX:()=>b,II:()=>y,kt:()=>k});var r=s(2960),a=s(6715),i=s(2115),n=s(4560),o=s(7165),u=s(5910),c=s(2020),l=class extends u.Q{#a;#i=void 0;#n;#o;constructor(t,e){super(),this.#a=t,this.setOptions(e),this.bindMethods(),this.#u()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){let e=this.options;this.options=this.#a.defaultMutationOptions(t),(0,c.f8)(this.options,e)||this.#a.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#n,observer:this}),e?.mutationKey&&this.options.mutationKey&&(0,c.EN)(e.mutationKey)!==(0,c.EN)(this.options.mutationKey)?this.reset():this.#n?.state.status==="pending"&&this.#n.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#n?.removeObserver(this)}onMutationUpdate(t){this.#u(),this.#c(t)}getCurrentResult(){return this.#i}reset(){this.#n?.removeObserver(this),this.#n=void 0,this.#u(),this.#c()}mutate(t,e){return this.#o=e,this.#n?.removeObserver(this),this.#n=this.#a.getMutationCache().build(this.#a,this.options),this.#n.addObserver(this),this.#n.execute(t)}#u(){let t=this.#n?.state??(0,n.$)();this.#i={...t,isPending:"pending"===t.status,isSuccess:"success"===t.status,isError:"error"===t.status,isIdle:"idle"===t.status,mutate:this.mutate,reset:this.reset}}#c(t){o.jG.batch(()=>{if(this.#o&&this.hasListeners()){let e=this.#i.variables,s=this.#i.context;t?.type==="success"?(this.#o.onSuccess?.(t.data,e,s),this.#o.onSettled?.(t.data,null,e,s)):t?.type==="error"&&(this.#o.onError?.(t.error,e,s),this.#o.onSettled?.(void 0,t.error,e,s))}this.listeners.forEach(t=>{t(this.#i)})})}};function h(t,e){let s=(0,a.jE)(e),[r]=i.useState(()=>new l(s,t));i.useEffect(()=>{r.setOptions(t)},[r,t]);let n=i.useSyncExternalStore(i.useCallback(t=>r.subscribe(o.jG.batchCalls(t)),[r]),()=>r.getCurrentResult(),()=>r.getCurrentResult()),u=i.useCallback((t,e)=>{r.mutate(t,e).catch(c.lQ)},[r]);if(n.error&&(0,c.GU)(r.options.throwOnError,[n.error]))throw n.error;return{...n,mutate:u,mutateAsync:n.mutate}}var d=s(7283);class p{async listMyOrgs(){return d.A.get("/api/v1/orgs")}async listAllOrgs(){return d.A.get("/api/v1/admin/orgs")}async createOrg(t){return d.A.post("/api/v1/orgs",t)}async getOrg(t){return d.A.get("/api/v1/admin/orgs/".concat(t))}async updateOrg(t,e){return d.A.put("/api/v1/orgs/".concat(t),e)}async deleteOrg(t){return d.A.delete("/api/v1/orgs/".concat(t))}async addOrgMember(t,e,s){return d.A.post("/api/v1/orgs/".concat(t,"/members"),{user_id:e,role_name:s})}async removeOrgMember(t,e){return d.A.delete("/api/v1/orgs/".concat(t,"/members/").concat(e))}}let g=new p,m={all:["orgs"],myOrgs:()=>[...m.all,"my-orgs"],allOrgs:()=>[...m.all,"all-orgs"],detail:t=>[...m.all,"detail",t]};function v(){return(0,r.I)({queryKey:m.allOrgs(),queryFn:()=>g.listAllOrgs(),staleTime:3e5})}function y(t){return(0,r.I)({queryKey:m.detail(t),queryFn:()=>g.getOrg(t),enabled:!!t})}function f(){let t=(0,a.jE)();return h({mutationFn:t=>g.createOrg(t),onSuccess:()=>{t.invalidateQueries({queryKey:m.myOrgs()}),t.invalidateQueries({queryKey:m.allOrgs()})}})}function b(){let t=(0,a.jE)();return h({mutationFn:t=>g.deleteOrg(t),onSuccess:(e,s)=>{t.invalidateQueries({queryKey:m.myOrgs()}),t.invalidateQueries({queryKey:m.allOrgs()}),t.removeQueries({queryKey:m.detail(s)})}})}function x(){let t=(0,a.jE)();return h({mutationFn:t=>{let{orgId:e,userId:s,roleName:r}=t;return g.addOrgMember(e,s,r)},onSuccess:(e,s)=>{let{orgId:r}=s;t.invalidateQueries({queryKey:m.detail(r)})}})}function k(){let t=(0,a.jE)();return h({mutationFn:t=>{let{orgId:e,userId:s}=t;return g.removeOrgMember(e,s)},onSuccess:(e,s)=>{let{orgId:r}=s;t.invalidateQueries({queryKey:m.detail(r)})}})}},9434:(t,e,s)=>{s.d(e,{cn:()=>i});var r=s(2596),a=s(9688);function i(){for(var t=arguments.length,e=Array(t),s=0;s<t;s++)e[s]=arguments[s];return(0,a.QP)((0,r.$)(e))}}}]);