(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[794],{2523:(e,s,a)=>{"use strict";a.d(s,{p:()=>l});var t=a(5155),r=a(2115),i=a(9434);let l=r.forwardRef((e,s)=>{let{className:a,type:r,...l}=e;return(0,t.jsx)("input",{type:r,className:(0,i.cn)("flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50",a),ref:s,...l})});l.displayName="Input"},3045:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>L});var t=a(5155),r=a(2115),i=a(5695),l=a(8860),n=a(2960),c=a(7283);class d{async listUsers(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=new URLSearchParams;e.page&&s.set("page",e.page.toString()),e.limit&&s.set("limit",e.limit.toString());let a="/api/v1/admin/users".concat(s.toString()?"?".concat(s.toString()):"");return c.A.get(a)}async getUser(e){return c.A.get("/api/v1/admin/users/".concat(e))}async createUser(e){return c.A.post("/api/v1/admin/users",e)}async updateUser(e,s){return c.A.put("/api/v1/admin/users/".concat(e),s)}async deleteUser(e){return c.A.delete("/api/v1/admin/users/".concat(e))}}let x=new d,m={all:["users"],list:e=>[...m.all,"list",e],detail:e=>[...m.all,"detail",e]};var h=a(6681),o=a(8497),u=a(285),p=a(6695),g=a(2523),j=a(6126),b=a(1154),v=a(2919),f=a(5339),y=a(5169),N=a(3227),w=a(9946);let k=(0,w.A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var A=a(7580);let _=(0,w.A)("user-plus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),S=(0,w.A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]),P=(0,w.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);var C=a(4616);let M=(0,w.A)("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);var D=a(7367);function L(){return(0,t.jsx)(D.A,{fallback:(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{children:"読み込み中..."})]})}),children:(0,t.jsx)(I,{})})}function I(){let e=(0,i.useSearchParams)(),s=(0,i.useRouter)(),a=parseInt(e.get("id")||"0"),[c,d]=(0,r.useState)(""),[w,D]=(0,r.useState)(!1),{isLoggedIn:L,loading:I}=(0,h.A)(),{isAdmin:U,getPermissionErrorMessage:$}=(0,o.S)(),{data:z,isLoading:E,error:R}=(0,l.II)(a),{data:q,isLoading:H}=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{page:1,limit:100};return(0,n.I)({queryKey:m.list(e),queryFn:()=>x.listUsers(e),staleTime:3e5})}(),Z=(0,l.LT)(),F=(0,l.kt)(),J=Array.isArray(null==q?void 0:q.users)?q.users:[],O=[],T=J.filter(e=>!O.some(s=>s.user_id===e.user_id)&&e.name.toLowerCase().includes(c.toLowerCase())),K=async e=>{try{await Z.mutateAsync({orgId:a,userId:e,roleName:"member"}),d(""),D(!1)}catch(e){console.error("メンバー追加エラー:",e)}},V=async(e,s)=>{if(confirm("".concat(s,"さんを組織から削除しますか？")))try{await F.mutateAsync({orgId:a,userId:e})}catch(e){console.error("メンバー削除エラー:",e)}};return I?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{children:"認証情報を確認中..."})]})}):L?U()?E?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(b.A,{className:"h-6 w-6 animate-spin"}),(0,t.jsx)("span",{children:"組織情報を読み込み中..."})]})}):R||!z?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)(p.Zp,{className:"p-6 max-w-md w-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-red-600 mb-2",children:"組織が見つかりません"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"指定された組織は存在しないか、アクセス権限がありません。"}),(0,t.jsx)(u.$,{onClick:()=>s.push("/dashboard/organizations"),children:"組織一覧に戻る"})]})})}):(0,t.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsxs)(u.$,{onClick:()=>s.push("/dashboard/organizations"),variant:"outline",className:"mb-6 flex items-center space-x-2 bg-white/10 border-white/20 text-white hover:bg-white/20",children:[(0,t.jsx)(y.A,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"組織一覧に戻る"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 mb-6",children:[(0,t.jsx)("div",{className:"bg-gradient-to-br from-blue-500 to-purple-600 p-4 rounded-xl shadow-lg",children:(0,t.jsx)(N.A,{className:"h-10 w-10 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-white mb-2",children:z.name}),(0,t.jsxs)("div",{className:"flex items-center space-x-4 text-gray-300",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(k,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:["作成日: ",new Date(z.created_at).toLocaleDateString("ja-JP")]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,t.jsx)(A.A,{className:"h-4 w-4"}),(0,t.jsxs)("span",{children:[O.length," メンバー"]})]})]})]})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)(p.Zp,{className:"p-6 bg-gradient-to-br from-white/10 via-white/5 to-transparent backdrop-blur-xl border border-white/20 rounded-2xl",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[(0,t.jsx)(N.A,{className:"h-5 w-5 mr-2"}),"組織情報"]}),(0,t.jsxs)("div",{className:"space-y-4 text-sm",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"組織ID"}),(0,t.jsxs)("span",{className:"font-mono text-blue-300",children:["#",z.id]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"オーナーID"}),(0,t.jsxs)("span",{className:"font-mono text-green-300",children:["#",z.owner_id]})]}),(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"作成日"}),(0,t.jsx)("span",{className:"text-gray-300",children:new Date(z.created_at).toLocaleDateString("ja-JP")})]}),z.updated_at&&z.updated_at!==z.created_at&&(0,t.jsxs)("div",{className:"flex justify-between items-center p-3 bg-white/5 rounded-lg",children:[(0,t.jsx)("span",{className:"text-gray-400",children:"更新日"}),(0,t.jsx)("span",{className:"text-gray-300",children:new Date(z.updated_at).toLocaleDateString("ja-JP")})]})]})]})}),(0,t.jsx)("div",{className:"lg:col-span-2",children:(0,t.jsxs)(p.Zp,{className:"p-6 bg-gradient-to-br from-white/10 via-white/5 to-transparent backdrop-blur-xl border border-white/20 rounded-2xl",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,t.jsxs)("h3",{className:"text-lg font-semibold text-white flex items-center",children:[(0,t.jsx)(A.A,{className:"h-5 w-5 mr-2"}),"組織メンバー (",O.length,")"]}),(0,t.jsxs)(u.$,{onClick:()=>D(!w),className:"bg-gradient-to-r from-green-600 to-blue-600 hover:from-green-700 hover:to-blue-700",children:[(0,t.jsx)(_,{className:"h-4 w-4 mr-2"}),"メンバーを追加"]})]}),w&&(0,t.jsxs)("div",{className:"mb-6 p-4 bg-white/5 rounded-lg border border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2 mb-4",children:[(0,t.jsx)(S,{className:"h-4 w-4 text-gray-400"}),(0,t.jsx)(g.p,{placeholder:"ユーザー名で検索...",value:c,onChange:e=>d(e.target.value),className:"bg-white/10 border-white/20 text-white placeholder:text-gray-400"})]}),(0,t.jsx)("div",{className:"max-h-60 overflow-y-auto space-y-2",children:H?(0,t.jsxs)("div",{className:"flex items-center justify-center py-4",children:[(0,t.jsx)(b.A,{className:"h-4 w-4 animate-spin mr-2"}),(0,t.jsx)("span",{className:"text-gray-400",children:"ユーザーを検索中..."})]}):T.length>0?T.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,t.jsx)(P,{className:"h-4 w-4 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:e.email})]})]}),(0,t.jsx)(u.$,{size:"sm",onClick:()=>K(e.user_id),disabled:Z.isPending,className:"bg-green-600 hover:bg-green-700",children:Z.isPending?(0,t.jsx)(b.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(C.A,{className:"h-4 w-4"})})]},e.user_id)):(0,t.jsx)("p",{className:"text-gray-400 text-center py-4",children:c?"検索条件に一致するユーザーが見つかりません":"ユーザー名を入力して検索してください"})})]}),(0,t.jsx)("div",{className:"space-y-3",children:O.length>0?O.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-white/5 rounded-lg border border-white/10",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center",children:(0,t.jsx)(P,{className:"h-5 w-5 text-white"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-white font-medium",children:e.name}),(0,t.jsx)("p",{className:"text-gray-400 text-sm",children:e.email})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(j.E,{variant:"secondary",className:"bg-blue-500/20 text-blue-300",children:e.role_name}),(0,t.jsx)(u.$,{size:"sm",variant:"outline",onClick:()=>V(e.user_id,e.name),disabled:F.isPending,className:"bg-red-500/10 border-red-500/30 text-red-400 hover:bg-red-500/20",children:F.isPending?(0,t.jsx)(b.A,{className:"h-4 w-4 animate-spin"}):(0,t.jsx)(M,{className:"h-4 w-4"})})]})]},e.user_id)):(0,t.jsxs)("div",{className:"text-center py-8",children:[(0,t.jsx)(A.A,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-400 mb-2",children:"この組織にはまだメンバーがいません"}),(0,t.jsx)("p",{className:"text-gray-500 text-sm",children:"「メンバーを追加」ボタンからユーザーを招待しましょう"})]})})]})})]})]})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)(p.Zp,{className:"p-8 max-w-md w-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(f.A,{className:"h-12 w-12 text-amber-500 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"アクセス権限がありません"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:$("admin")}),(0,t.jsx)(u.$,{onClick:()=>s.push("/dashboard"),variant:"outline",className:"w-full",children:"ダッシュボードに戻る"})]})})}):(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,t.jsx)(p.Zp,{className:"p-8 max-w-md w-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(v.A,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"ログインが必要です"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:$()}),(0,t.jsx)(u.$,{onClick:()=>s.push("/login"),className:"w-full",children:"ログインページへ"})]})})})}},4616:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},4909:(e,s,a)=>{Promise.resolve().then(a.bind(a,3045))},5169:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("arrow-left",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]])},5695:(e,s,a)=>{"use strict";var t=a(8999);a.o(t,"useRouter")&&a.d(s,{useRouter:function(){return t.useRouter}}),a.o(t,"useSearchParams")&&a.d(s,{useSearchParams:function(){return t.useSearchParams}})},6126:(e,s,a)=>{"use strict";a.d(s,{E:()=>c});var t=a(5155);a(2115);var r=a(4624),i=a(2085),l=a(9434);let n=(0,i.F)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function c(e){let{className:s,variant:a,asChild:i=!1,...c}=e,d=i?r.DX:"span";return(0,t.jsx)(d,{"data-slot":"badge",className:(0,l.cn)(n({variant:a}),s),...c})}},7367:(e,s,a)=>{"use strict";a.d(s,{A:()=>i});var t=a(5155),r=a(2115);function i(e){let{children:s,fallback:a=null}=e,[i,l]=(0,r.useState)(!1);return((0,r.useEffect)(()=>{l(!0)},[]),i)?(0,t.jsx)(t.Fragment,{children:s}):(0,t.jsx)(t.Fragment,{children:a})}},7580:(e,s,a)=>{"use strict";a.d(s,{A:()=>t});let t=(0,a(9946).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])}},e=>{e.O(0,[212,967,426,325,441,964,358],()=>e(e.s=4909)),_N_E=e.O()}]);