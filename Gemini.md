# Gemini.md - Winyx ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®æŒ‡ç¤ºæ›¸

## é‡è¦ãªæŒ‡ç¤º

### è¨€èªè¨­å®š
**å¿…ãšæ—¥æœ¬èªã§è¿”ç­”ã™ã‚‹ã“ã¨ã€‚** ã™ã¹ã¦ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€èª¬æ˜ã€ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã€ã‚³ãƒ¡ãƒ³ãƒˆã¯æ—¥æœ¬èªã§è¨˜è¿°ã—ã¦ãã ã•ã„ã€‚

---

## 0. ã‚´ãƒ¼ãƒ«
- åˆå­¦è€…ã«ã‚‚åˆ†ã‹ã‚‹èª¬æ˜ã‚’å¾¹åº•ã—ã€**å…ˆèµ°ã‚‰ãš**ã«å¸¸ã« *è¤‡æ•°ã®é¸æŠè‚¢ï¼ˆA/B...ï¼‰ã¨æ¡ç”¨ç†ç”±* ã‚’ç¤ºã™ã€‚
- ã™ã¹ã¦ã®ã‚³ãƒ¼ãƒ‰æ–­ç‰‡ãƒ»ã‚³ãƒãƒ³ãƒ‰ã®ç›´å‰ã«ã€**ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ä»˜ãã®ç°¡æ½”ãªèª¬æ˜**ã‚’ç½®ãï¼ˆé€²æ—ãŒè¦‹ãˆã‚‹ã‚ˆã†ã«ï¼‰ã€‚
- Winyxã®**å‘½åè¦ç´„ã¨é…ç½®è¦ç´„**ã‚’å®ˆã‚Šã€åŒã˜è¡¨è¨˜ã‚’å…¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚³ãƒ¼ãƒ‰ã«åæ˜ ã™ã‚‹ã€‚
- è¿”ç­”ã¯æ—¥æœ¬èªã€‚ç«¯æœ«æ“ä½œã®èª¬æ˜ã¯ **vim å‰æ**ï¼ˆnanoã¯ä¸å¯ï¼‰ã€‚
- sudoæ¨©é™ã®å¿…è¦ãªå‡¦ç†ã¯ã€ã©ã®ã‚ˆã†ãªå‡¦ç†ã‚’è¡Œã†ã®ã‹ã‚’ç¤ºã—ã¦ã€ç§ã«é ¼ã‚“ã§ä¸‹ã•ã„ã€‚

---

## 1. è¿”ç­”ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆè¦å‰‡ï¼ˆå³å®ˆï¼‰
- å„ã‚³ãƒ¼ãƒ‰ã®**ç›´å‰**ã«æœ€å°é™ã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã‚’ç½®ãï¼š

  ```md
  - [ ] ä½•ã‚’ã™ã‚‹ã‹ï¼ˆ1è¡Œèª¬æ˜ï¼‰

  ```bash
  # å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰/ã‚³ãƒ¼ãƒ‰
  ```
  > ç›®çš„ã‚„çµæœï¼ˆ1è¡Œãƒ¡ãƒ¢ï¼‰
  ```

- ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆã¯ä»¥ä¸‹ã‚’åŸºæœ¬ã¨ã™ã‚‹ï¼š
  1) èƒŒæ™¯ã¨é¸æŠè‚¢ï¼ˆA/B/Cï¼‰  
  2) æ¨å¥¨ã®æ ¹æ‹ ï¼ˆ3ç‚¹ä»¥å†…ï¼‰  
  3) æ‰‹é †ï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ + ã‚³ãƒ¼ãƒ‰ï¼‰  
  4) æ¤œè¨¼/ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯æ‰‹é †  
  5) æ³¨æ„ç‚¹ï¼ˆè½ã¨ã—ç©´ï¼‰

- **vimæ“ä½œ**ã®ä¾‹ç¤ºã‚’å„ªå…ˆï¼ˆ`:wq`, æ¤œç´¢ç½®æ› `:%s/old/new/g` ç­‰ï¼‰ã€‚

---

## 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
Winyxã¯å¥‘ç´„é§†å‹•é–‹ç™ºï¼ˆContract-Firstï¼‰ã‚’æ¡ç”¨ã—ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚’VPSä¸Šã§ç¨¼åƒã•ã›ã€ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«PCã§é–‹ç™ºãƒ»ãƒ“ãƒ«ãƒ‰å¾Œã«VPSã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹æ§‹æˆã§ã™ãŒã€VPSä¸Šã§ã€é–‹ç™ºã—ã¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€‚å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.api/.protoï¼‰ã‚’å˜ä¸€ã‚½ãƒ¼ã‚¹ã¨ã—ã¦é›†ä¸­ç®¡ç†ã—ã€CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§å‹å®šç¾©ã€SDKã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€ãƒ¢ãƒƒã‚¯ã‚’è‡ªå‹•ç”Ÿæˆã—ã¦é…å¸ƒã—ã¾ã™ã€‚

### ãƒªãƒã‚¸ãƒˆãƒªæ§‹é€ 
- `/var/www/winyx` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- `backend/` - Go-Zeroã«ã‚ˆã‚‹ã‚µãƒ¼ãƒ“ã‚¹å®Ÿè£…
  - `test_api/` - ãƒ†ã‚¹ãƒˆAPIã‚µãƒ¼ãƒ“ã‚¹ (Go-Zero)
- `frontend/` - ãƒ“ãƒ«ãƒ‰æ¸ˆã¿é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆNext.jså‡ºåŠ›ï¼‰
- `contracts/` - å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ãƒªãƒã‚¸ãƒˆãƒª
  - `api/` - .apiï¼ˆRESTå¥‘ç´„å®šç¾©ï¼‰ã¨DDLã‚¹ã‚­ãƒ¼ãƒ
  - `rpc/` - .protoï¼ˆgRPCå¥‘ç´„å®šç¾©ï¼‰
- `scripts/` - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚„ç®¡ç†ç”¨ãƒ„ãƒ¼ãƒ«
- `docs/` - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- `.env` - ç’°å¢ƒå¤‰æ•°è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆGitç®¡ç†å¤–ï¼‰
- `.env.example` - ç’°å¢ƒå¤‰æ•°ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### å‘½åã¨ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ï¼ˆWinyxæ¨™æº–ï¼‰
- **ã‚µãƒ¼ãƒ“ã‚¹å**ï¼š`snake_case` ã¾ãŸã¯ `lowerCamel`ã€‚**ãƒã‚¤ãƒ•ãƒ³ç¦æ­¢**ï¼ˆä¾‹ï¼š`user_service` ã¯OKã€`user-service` ã¯NGï¼‰ã€‚
- **YAMLã® Name:** ã¯ **ã‚µãƒ¼ãƒ“ã‚¹åã¨åŒä¸€**ï¼ˆä¾‹ï¼š`Name: user_service`ï¼‰ã€‚
- **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å**ï¼š`etc/<service>-api.yaml` ã‚’æ¨å¥¨ï¼ˆä¾‹ï¼š`etc/user_service-api.yaml`ï¼‰ã€‚
- **ã‚µãƒ¼ãƒ“ã‚¹ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**ï¼š`/var/www/winyx/backend/` é…ä¸‹ã« `<service_name>` ã§ä½œæˆï¼ˆä¾‹ï¼š`user_service`, `order_service`ï¼‰ã€‚
- **systemdã‚µãƒ¼ãƒ“ã‚¹å**ï¼š`winyx-<service>.service` å½¢å¼ï¼ˆä¾‹ï¼š`winyx-user.service`, `winyx-order.service`ï¼‰ã€‚
- **VPS é…ç½®**ï¼š`/var/www/winyx/` é…ä¸‹ï¼ˆ`backend/`, `frontend/`, `contracts/`ï¼‰ã€‚

### é–‹ç™ºãƒ»ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ•ãƒ­ãƒ¼
```
[ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ]
â”œâ”€â”€ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆNext.jsï¼‰: ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° â†’ ãƒ“ãƒ«ãƒ‰ â†’ é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆ
â”œâ”€â”€ å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›†ï¼ˆ.api/.protoï¼‰: ã‚³ãƒŸãƒƒãƒˆ â†’ CIã§è‡ªå‹•ç”Ÿæˆ
â””â”€â”€ ç”Ÿæˆç‰©ï¼ˆå‹/SDK/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/ãƒ¢ãƒƒã‚¯ï¼‰ã‚’npmã‚„é™çš„é…ä¿¡ã§ãƒ•ãƒ­ãƒ³ãƒˆã¸é…å¸ƒ

[VPSæœ¬ç•ªç’°å¢ƒï¼ˆ/var/www/winyxï¼‰]
â”œâ”€â”€ frontend/ï¼ˆãƒ“ãƒ«ãƒ‰æ¸ˆã¿é™çš„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Nginxã§é…ä¿¡ï¼‰
â”œâ”€â”€ backend/ï¼ˆGo-Zeroã‚µãƒ¼ãƒ“ã‚¹ç¾¤: REST APIã‚„RPCã‚µãƒ¼ãƒ“ã‚¹ã‚’systemdã§å¸¸é§ï¼‰
â””â”€â”€ contracts/ï¼ˆå¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ã®ç®¡ç†ãƒªãƒã‚¸ãƒˆãƒªï¼‰
```

---

## 3. é–‹ç™ºç’°å¢ƒ

### ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ç’°å¢ƒå‰æ
- OS: Ubuntu 24.04 LTS
- Timezone: Asia/Tokyo
- DB: MariaDBï¼ˆ`winyx_core`ï¼‰ã€Redisï¼ˆãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
- Go version: 1.24+
- Framework: Go-Zero + goctl (æœ€æ–°)
- ãƒ•ãƒ­ãƒ³ãƒˆï¼šNext.js 15ï¼ˆVPSã«ã¯ãƒ“ãƒ«ãƒ‰çµæœã®ã¿é…ç½®ï¼‰
- Cache: Redis

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦ç´„
- Goãƒ•ã‚¡ã‚¤ãƒ«åã¯å°æ–‡å­—ã®ã¿ã‚’ä½¿ç”¨ï¼ˆä¾‹: `loginhandler.go`ã€`servicecontext.go`ï¼‰
- ã‚±ãƒ¼ã‚¹ã‚»ãƒ³ã‚·ãƒ†ã‚£ãƒ–ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã§ã®å‹•ä½œã‚’å‰æã¨ã™ã‚‹

---

## 4. å¥‘ç´„é§†å‹•é–‹ç™ºï¼ˆContract-First Developmentï¼‰**ã€å³å®ˆã€‘**

### 4.0 **çµ¶å¯¾åŸå‰‡ï¼šContract-First + Go-Zeroè‡ªå‹•ç”Ÿæˆ**
- **çµ¶å¯¾ã«å®ˆã‚‹**ï¼šã™ã¹ã¦ã®APIã¯**å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.apiï¼‰ã‚’å…ˆã«ä½œæˆ**ã—ã¦ã‹ã‚‰å®Ÿè£…
- **æ‰‹å‹•å®Ÿè£…ç¦æ­¢**ï¼š`goctl api generate`ã‚’ä½¿ã‚ãªã„æ‰‹å‹•å®Ÿè£…ã¯**ä¸€åˆ‡ç¦æ­¢**
- **å˜ä¸€æƒ…å ±æº**ï¼š`/var/www/winyx/contracts/`ã‚’**å”¯ä¸€ã®å¥‘ç´„ç®¡ç†å ´æ‰€**ã¨ã™ã‚‹

### 4.1 **å¿…é ˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**
```bash
# 1. å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆãƒ»æ›´æ–°ï¼ˆå¿…é ˆï¼‰
vim /var/www/winyx/contracts/<service_name>/<service>.api

# 2. Go-Zeroè‡ªå‹•ç”Ÿæˆï¼ˆå¿…é ˆï¼‰
cd /var/www/winyx/backend/<service_name>
goctl api go -api /var/www/winyx/contracts/<service_name>/<service>.api -dir . -style go_zero

# 3. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’è¿½åŠ 
# internal/logic/ å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ç·¨é›†å¯èƒ½

# 4. å¥‘ç´„åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œï¼ˆå¿…é ˆï¼‰
/var/www/winyx/scripts/sync_contracts.sh
```

### 4.2 **ç·¨é›†å¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«åˆ¶é™**
- âœ… **ç·¨é›†å¯èƒ½**ï¼š`internal/logic/` - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®ã¿
- âœ… **ç·¨é›†å¯èƒ½**ï¼š`etc/` - è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
- âŒ **ç·¨é›†ç¦æ­¢**ï¼š`internal/handler/` - è‡ªå‹•ç”Ÿæˆã®ãŸã‚
- âŒ **ç·¨é›†ç¦æ­¢**ï¼š`internal/types/` - è‡ªå‹•ç”Ÿæˆã®ãŸã‚
- âŒ **ç·¨é›†ç¦æ­¢**ï¼š`routes.go` - è‡ªå‹•ç”Ÿæˆã®ãŸã‚

### 4.3 **å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«å‘½åè¦å‰‡**
- **å ´æ‰€**ï¼š`/var/www/winyx/contracts/<service_name>/<service>.api`
- **ä¾‹**ï¼š`/var/www/winyx/contracts/user_service/user.api`
- **ã‚¹ã‚¿ã‚¤ãƒ«**ï¼š`go_zero`å½¢å¼ã§çµ±ä¸€

---

## 5. ã‚ˆãã‚ã‚‹åˆ¤æ–­ï¼ˆå…ˆã«çµè«– â†’ æ ¹æ‹ ï¼‰

### 5.1 go-zero å°å…¥ã‚³ãƒãƒ³ãƒ‰
- **çµè«–**ï¼š
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ä¾å­˜ã¨ã—ã¦ go-zero ã‚’å…¥ã‚Œã‚‹ â†’ `go get github.com/zeromicro/go-zero@latest`
  - CLIï¼ˆgoctlï¼‰ã¯**å®Ÿè¡Œãƒã‚¤ãƒŠãƒª**ã¨ã—ã¦å…¥ã‚Œã‚‹ â†’ `go install github.com/zeromicro/go-zero/tools/goctl@latest`
- **æ ¹æ‹ **ï¼š`go get` ã¯ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ä¾å­˜ï¼ˆ`go.mod`ï¼‰ã‚’æ›´æ–°ã€`go install` ã¯ `$GOBIN` ã«ãƒ„ãƒ¼ãƒ«é…ç½®ã€‚å½¹å‰²ãŒç•°ãªã‚‹ã€‚

### 5.2 ã‚µãƒ¼ãƒ“ã‚¹åã¨ YAML Name ã®çµ±ä¸€
- **çµè«–**ï¼š`user_service`ï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰ â‡„ `Name: user_service`ï¼ˆYAMLï¼‰ã§**å®Œå…¨ä¸€è‡´**ã•ã›ã‚‹ã€‚
- **ç†ç”±**ï¼šç›£è¦–ãƒ»systemdãƒ»ãƒ­ã‚°ã€OpenAPIåå¯„ã›ã®æ··ä¹±ã‚’é˜²ãï¼ãƒãƒ¼ãƒ å†…æ¤œç´¢ã®ãƒ’ãƒƒãƒˆç‡ã‚’ä¸Šã’ã‚‹ã€‚

### 5.3 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«åã®çµ±ä¸€
- **çµè«–**ï¼š`etc/<service>-api.yaml`ï¼ˆä¾‹ï¼š`etc/user_service-api.yaml`ï¼‰ã§çµ±ä¸€ã€‚
- **ç†ç”±**ï¼šgoctl ç”Ÿæˆç‰©ã®æ…£ç¿’ã«æ²¿ã„ã¤ã¤ã€äººé–“å¯èª­æ€§ï¼ˆã©ã®ã‚µãƒ¼ãƒ“ã‚¹ã® API è¨­å®šã‹å³åˆ†ã‹ã‚‹ï¼‰ã€‚

---

## 6. ãƒ†ã‚¹ãƒˆã¨ãƒ“ãƒ«ãƒ‰
- ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰: `go build`
- ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰: `go test ./...`
- å‹ãƒã‚§ãƒƒã‚¯ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼‰: `npm run type-check`
- ãƒªãƒ³ãƒˆ: `npm run lint`

### ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†
- systemdã‚µãƒ¼ãƒ“ã‚¹å: `winyx-test-api.service`
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«: `etc/test_api-api.yaml`

---

## 7. ä½œæ¥­ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### 7.1 ã€Œé¸æŠè‚¢ â†’ æ‰‹é † â†’ æ¤œè¨¼ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼ˆé››å½¢ï¼‰
**A/B/C ã®æç¤ºã¨æ¡ç”¨ç†ç”±ã‚’å…ˆã«æ›¸ãã€‚**

- [ ] Aæ¡ˆï¼ˆæ¨å¥¨ï¼‰ï¼šã€œã€œ / Bæ¡ˆï¼šã€œã€œ / Cæ¡ˆï¼šã€œã€œï¼ˆæ¡ç”¨ç†ç”±ã‚’3ç‚¹ä»¥å†…ã§ï¼‰

```md
- [ ] æ‰‹é † 1ï¼ˆä½•ã‚’ã™ã‚‹ã‹ï¼‰

```bash
# ã‚³ãƒãƒ³ãƒ‰
```

- [ ] æ‰‹é † 2ï¼ˆä½•ã‚’ã™ã‚‹ã‹ï¼‰

```bash
# ã‚³ãƒãƒ³ãƒ‰
```
> æ¤œè¨¼ï¼šcurl / health ãªã©1è¡Œ
```

### 7.2 Go-Zeroï¼šæœ€å°ã‚µãƒ¼ãƒ“ã‚¹ã®ç”Ÿæˆã¨èµ·å‹•
- [ ] ã‚µãƒ¼ãƒ“ã‚¹é››å½¢ã‚’ç”Ÿæˆï¼ˆãƒã‚¤ãƒ•ãƒ³ä¸å¯ï¼‰

```bash
cd /var/www/winyx/backend
goctl api new test_api
cd test_api
```

- [ ] types/logic ã‚’ JSONè¿”å´ã«ä¿®æ­£ï¼ˆè‡ªå‹• or vimï¼‰

```bash
# types.go ã®æœ€å°ä¾‹
cat > internal/types/types.go <<'EOF'
package types

type Request struct {
    Name string `path:"name"` // â€»ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¯ãƒ­ã‚¸ãƒƒã‚¯å´ã§è£œã†
}
type Response struct {
    Message string `json:"message"`
}
EOF
```

> ç›®çš„ï¼šæ–‡å­—åˆ—ã‚’ JSON ã§è¿”ã™åŸºæœ¬æŒ™å‹•ã‚’å›ºå®š

- [ ] ä¾å­˜è§£æ±ºã¨ãƒ“ãƒ«ãƒ‰

```bash
go mod tidy
go build -o test_api
```

- [ ] è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆçµ±ä¸€å‘½åï¼‰

```bash
mkdir -p etc
cat > etc/test_api-api.yaml <<'YAML'
Name: test_api
Host: 0.0.0.0
Port: 8888

Mysql:
  DataSource: "winyx_app:YOUR_DB_PASSWORD@tcp(127.0.0.1:3306)/winyx_core?charset=utf8mb4&parseTime=true&loc=Asia%2FTokyo"

Cache:
  - Host: 127.0.0.1:6379
    Pass: "" # ä»˜ã‘ã‚‹å ´åˆã®ã¿å€¤ã‚’è¨­å®š
YAML
```

- [ ] èµ·å‹•ã¨ç–é€š

```bash
./test_api -f etc/test_api-api.yaml &
PID=$!; echo $PID > /tmp/test_api.pid
curl -s http://127.0.0.1:8888/from/you | jq . || true
kill "$(cat /tmp/test_api.pid)"
```

> æœŸå¾…ï¼šJSONã§ `{ "message": "Hello you!" }`

---

## 8. è¨­å®šãƒ»å®Ÿè£…ã‚¬ã‚¤ãƒ‰

### 8.1 DB/Redis
- [ ] MariaDB ã®ç–é€šç¢ºèªï¼ˆæœ€ä½é™ï¼‰

```bash
mariadb -h 127.0.0.1 -u winyx_app -p -D winyx_core -e "SELECT NOW() AS now, @@version AS version;"
```

- [ ] Redis ã®ç–é€šç¢ºèª

```bash
redis-cli -h 127.0.0.1 ping
# â†’ PONGï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚ã‚Šãªã‚‰ -a ã‚’ä»˜ä¸ï¼‰
```

### 8.2 goctl modelï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹ï¼‰
- [ ] DDL ã‹ã‚‰ model ã‚’ç”Ÿæˆï¼ˆDDLã‚¹ã‚­ãƒ¼ãƒã¯ contracts/api ã§ç®¡ç†ï¼‰

```bash
cd /var/www/winyx/backend/test_api
goctl model mysql ddl -src /var/www/winyx/contracts/api/schema.sql -dir ./internal/model -c
```

### 8.3 Handler / Logic ã®æœ€å°æ§‹æˆï¼ˆCRUDä¾‹ï¼‰
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ç™»éŒ²ï¼ˆ5æœ¬ï¼šPOST/GET/GET/LIST/DELETEï¼‰

```bash
vim /var/www/winyx/backend/test_api/internal/handler/routes.go
# server.AddRoutes([...]) ã« Users ã®5æœ¬ã‚’è¿½åŠ 
```

- [ ] Handler â†’ Logic â†’ Model ã®è–„ã„ä¸‰å±¤ã‚’ç¶­æŒï¼ˆè¤‡é›‘åŒ–ã‚’é¿ã‘ã‚‹ï¼‰

---

## 9. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆã®æµå„€
- ã€Œç¬¬Nç«  ç¬¬Mç¯€ ...ã€ã®**ç« ç•ªå·ã‚’å´©ã•ãªã„**ã€‚è‰æ¡ˆã«ç•°ãªã‚‹æ•°å­—ãŒæ··åœ¨ã—ã¦ã„ã‚‹å ´åˆã¯**ã“ã®è¦ç´„ã«å¾“ã£ã¦ä¿®æ­£**ã€‚
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®**è¡¨è¨˜ã‚†ã‚Œã‚’è¨±å®¹ã—ãªã„**ï¼š
  - **Name** ã¯ `test_api` å›ºå®š
  - **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å**ã¯ `test_api-api.yaml` å›ºå®š
  - æœ¬æ–‡å†…ã« `testapi_api.yaml` / `testapi-api.yaml` ã®ä¸¡æ–¹ãŒç¾ã‚ŒãŸå ´åˆã¯ **å‰è€…ã«çµ±ä¸€**ã§ã¯ãªãã€æœ¬è¦ç´„ï¼ˆ`test_api-api.yaml`ï¼‰ã¸åˆã‚ã›ã‚‹ã€‚

---

## 10. å®‰å…¨ç­–ãƒ»è½ã¨ã—ç©´
- **ã‚µãƒ¼ãƒ“ã‚¹åãƒã‚¤ãƒ•ãƒ³**ã¯ç”Ÿæˆæ¸ˆã¿ã‚³ãƒ¼ãƒ‰ã® import path ã«é½Ÿé½¬ã‚’ç”Ÿã‚€ã€‚å¿…ãš snake_caseã€‚
- **path ã‚¿ã‚°ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤**ã¯ãƒ‘ãƒ¼ã‚µã«ã‚ˆã‚Šç„¡è¦–ã•ã‚Œã‚‹ã“ã¨ãŒã‚ã‚‹ãŸã‚ã€**ãƒ­ã‚¸ãƒƒã‚¯å´ã§ç©ºæ–‡å­—ã‚’è£œå®Œ**ã™ã‚‹ã€‚
- **æ©Ÿå¾®æƒ…å ±**ã¯ YAML ã«ç›´æ›¸ãã›ãšã€ç’°å¢ƒå¤‰æ•°ï¼ˆ`.env`ãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ã¾ãŸã¯ `/etc/winyx.d/<service>.env` ï¼‹ systemd `EnvironmentFile=` ã‚’æ¨å¥¨ã€‚
- **RESTã¨RPCä½¿ã„åˆ†ã‘**ï¼šå¤–éƒ¨å…¬é–‹APIã¯RESTã€å†…éƒ¨é«˜é€Ÿé€šä¿¡ã¯RPCã‚’æ¨å¥¨ã€‚

---

## 11. ææ¡ˆã®å‡ºã—æ–¹ï¼ˆå†…éƒ¨ãƒ«ãƒ¼ãƒ«ï¼‰
- åŒã˜çµæœã«è‡³ã‚‹æ‰‹æ®µãŒè¤‡æ•°ã‚ã‚‹å ´åˆã€**3ä»¶ä»¥å†…ã®é¸æŠè‚¢**ã¨**æ¡ç”¨åŸºæº–**ï¼ˆå®‰å®šæ€§/é‹ç”¨å®¹æ˜“æ€§/å­¦ç¿’ã‚³ã‚¹ãƒˆç­‰ï¼‰ã‚’çŸ­ãæç¤ºã€‚
- åˆå­¦è€…å‘ã‘ã«ã€**è½ã¨ã—ç©´ï¼ˆ3ã¤ä»¥å†…ï¼‰**ã¨**æ¤œè¨¼ã‚³ãƒãƒ³ãƒ‰ï¼ˆ1ï½2å€‹ï¼‰**ã‚’å¿…ãšæ·»ãˆã‚‹ã€‚
- è¿”ä¿¡ã®æœ€å¾Œã«ã€Œæ¬¡ã®ä¸€æ­©ã€ã‚’1è¡Œç¤ºã™ï¼ˆä¾‹ï¼š*ã€ŒWorkDir ã‚’ systemd åŒ–ã—ã¾ã—ã‚‡ã†ã€*ï¼‰ã€‚

---

## 12. å¥‘ç´„é§†å‹•é–‹ç™ºï¼ˆContract-Driven Developmentï¼‰

### 12.1 åŸºæœ¬æ¦‚å¿µ
- å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ.api/.protoï¼‰ã‚’å˜ä¸€ã®ä¿¡é ¼ã§ãã‚‹æƒ…å ±æºã¨ã—ã¦ä½¿ç”¨
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®ä»•æ§˜é½Ÿé½¬ã‚’é˜²ãé–‹ç™ºæ‰‹æ³•
- RESTã¯ `.api` â†’ `goctl api plugin` ã§OpenAPIã«å¤‰æ›
- RPCã¯ `.proto` â†’ `buf`ã§lintãŠã‚ˆã³å¾Œæ–¹äº’æ›æ€§ãƒã‚§ãƒƒã‚¯

### 12.2 è‡ªå‹•ç”Ÿæˆã‚·ã‚¹ãƒ†ãƒ 
CIã§ä»¥ä¸‹ã‚’ç”Ÿæˆã—é…å¸ƒï¼š
- TypeScriptå‹å®šç¾©ã¨APIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆfetch/axios ã¾ãŸã¯ gRPCã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰
- Flutter/Dartç”¨ã‚³ãƒ¼ãƒ‰
- APIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼ˆRedoc/Swagger UIï¼‰
- ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒå®šç¾©ï¼ˆPrism / connect dev serverï¼‰
- å¥‘ç´„ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´æ™‚ã®è‡ªå‹•åŒæœŸï¼ˆGit hooksé€£æºï¼‰

### 12.3 å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰
```bash
# æ‰‹å‹•å®Ÿè¡Œ
./scripts/sync_contracts.sh

# ç›£è¦–ãƒ¢ãƒ¼ãƒ‰
./scripts/sync_contracts.sh --watch

# Git hooks ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
./scripts/sync_contracts.sh --install-hooks
```

### 12.4 å¥‘ç´„ä¾‹

#### RESTå¥‘ç´„ä¾‹ï¼ˆ.apiï¼‰
```api
syntax = "v1";
info(
  title: "User Service API"
  desc:  "User CRUD endpoints"
)

type (
  UserResp {
    id    int64  `json:"id"`
    name  string `json:"name"`
    email string `json:"email"`
  }
)

@server(group: user)
service user-api {
  @doc "Get user by ID"
  get /api/v1/users/:id returns(UserResp)
}
```

#### RPCå¥‘ç´„ä¾‹ï¼ˆ.protoï¼‰
```proto
syntax = "proto3";
package user.v1;
option go_package = "./pb;pb";

message GetUserReq { int64 id = 1; }
message User { int64 id = 1; string name = 2; string email = 3; }
service UserService {
  rpc GetUser(GetUserReq) returns (User);
}
```

### 12.5 ã‚¨ãƒ©ãƒ¼ãƒ¢ãƒ‡ãƒ«çµ±ä¸€
å…¨APIã§åŒä¸€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’è¿”å´ï¼š
```json
{
  "code": "USER_NOT_FOUND",
  "message": "User not found",
  "details": { "id": 123 }
}
```

### 12.6 å¤‰æ›´æ¤œçŸ¥ã¨å®‰å…¨è£…ç½®
- REST: `oasdiff --fail-on-breaking`ã§ç ´å£Šçš„å¤‰æ›´æ¤œçŸ¥
- RPC: `buf breaking`ã§å¾Œæ–¹äº’æ›æ€§ãƒã‚§ãƒƒã‚¯
- CIã§é•åãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã¯ãƒãƒ¼ã‚¸ä¸å¯ã«è¨­å®š

### 12.7 ãƒ•ãƒ­ãƒ³ãƒˆåˆ©ç”¨æ‰‹é †
1. npmçµŒç”±ã§SDKã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼š`npm install @winyx/api-client` ã¾ãŸã¯ `@winyx/rpc-client`
2. å‹å®‰å…¨ãªå‘¼ã³å‡ºã—ã§ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚„RPCã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨
3. ãƒ¢ãƒƒã‚¯ã‚µãƒ¼ãƒã‚’èµ·å‹•ã—ã¦ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ä¾å­˜ãªã—ã§UIé–‹ç™ºå¯èƒ½

---

## 13. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæˆ¦ç•¥ï¼ˆMicroservices DB Strategyï¼‰

### 13.1 åŸºæœ¬è¨­è¨ˆæ–¹é‡
Winyxãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯**ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‹Database per Service**ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   winyx_core    â”‚    â”‚   winyx_task    â”‚    â”‚   winyx_msg     â”‚
â”‚   (å…±é€šãƒ»èªè¨¼)   â”‚    â”‚  (ã‚¿ã‚¹ã‚¯ç®¡ç†)    â”‚    â”‚ (ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸)     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ users         â”‚    â”‚ â€¢ tasks         â”‚    â”‚ â€¢ messages      â”‚
â”‚ âœ“ sessions      â”‚    â”‚ â€¢ task_assign   â”‚    â”‚ â€¢ channels      â”‚
â”‚ âœ“ user_profiles â”‚    â”‚ â€¢ categories    â”‚    â”‚ â€¢ participants  â”‚
â”‚ âœ“ roles         â”‚    â”‚ â€¢ task_history  â”‚    â”‚ â€¢ attachments   â”‚
â”‚ âœ“ permissions   â”‚    â”‚ â€¢ comments      â”‚    â”‚ â€¢ message_read  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 13.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†æ•£ãƒ«ãƒ¼ãƒ«

#### ğŸ“Š winyx_coreï¼ˆèªè¨¼åŸºç›¤ï¼‰
**è²¬ä»»ç¯„å›²**: ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ãƒ»èªå¯ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†ã€ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
- ğŸ¯ **å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹**: UserServiceã€AuthServiceã€GatewayService
- ğŸ”§ **æ¥ç¶šè¨­å®š**: `DataSource: "winyx:PASSWORD@tcp(127.0.0.1:3306)/winyx_core?charset=utf8mb4&parseTime=true"`

#### ğŸ“‹ winyx_taskï¼ˆã‚¿ã‚¹ã‚¯ç®¡ç†ï¼‰
**è²¬ä»»ç¯„å›²**: ã‚¿ã‚¹ã‚¯ä½œæˆãƒ»ç®¡ç†ã€ã‚¢ã‚µã‚¤ãƒ³ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒªãƒ³ã‚°ã€ã‚³ãƒ¡ãƒ³ãƒˆãƒ»æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«
- ğŸ¯ **å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹**: TaskServiceã€ProjectService
- ğŸ”§ **æ¥ç¶šè¨­å®š**: `DataSource: "winyx:PASSWORD@tcp(127.0.0.1:3306)/winyx_task?charset=utf8mb4&parseTime=true"`

#### ğŸ’¬ winyx_memï¼ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†ï¼‰
**è²¬ä»»ç¯„å›²**: ãƒãƒ£ãƒ³ãƒãƒ«ç®¡ç†ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã€ãƒ•ã‚¡ã‚¤ãƒ«å…±æœ‰
- ğŸ¯ **å¯¾è±¡ã‚µãƒ¼ãƒ“ã‚¹**: MessageServiceã€NotificationService
- ğŸ”§ **æ¥ç¶šè¨­å®š**: `DataSource: "winyx:PASSWORD@tcp(127.0.0.1:3306)/winyx_mem?charset=utf8mb4&parseTime=true"`

### 13.3 ã‚µãƒ¼ãƒ“ã‚¹é–“ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹ãƒ«ãƒ¼ãƒ«

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: APIå‘¼ã³å‡ºã—ï¼ˆæ¨å¥¨ï¼‰
```go
// TaskServiceã‹ã‚‰UserServiceã®æƒ…å ±å–å¾—
type TaskService struct {
    userClient UserServiceClient
}

func (s *TaskService) GetTaskWithUser(taskId int64) (*TaskWithUser, error) {
    task, err := s.taskRepo.FindById(taskId)
    if err != nil {
        return nil, err
    }
    
    // UserServiceã®APIã‚’å‘¼ã³å‡ºã—
    user, err := s.userClient.GetUser(context.Background(), task.UserId)
    if err != nil {
        logx.Errorf("Failed to get user info: %v", err)
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—å¤±æ•—ã§ã‚‚ã‚¿ã‚¹ã‚¯æƒ…å ±ã¯è¿”å´
        return &TaskWithUser{Task: task}, nil
    }
    
    return &TaskWithUser{Task: task, User: user}, nil
}
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ã‚¤ãƒ™ãƒ³ãƒˆé§†å‹•åŒæœŸï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥æ›´æ–°ï¼‰
```go
// ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
func (l *UserUpdateLogic) UserUpdate(req *types.UserUpdateReq) error {
    // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°
    err := l.svcCtx.UsersModel.Update(l.ctx, updatedUser)
    if err != nil {
        return err
    }
    
    // ä»–ã‚µãƒ¼ãƒ“ã‚¹ã«å¤‰æ›´é€šçŸ¥ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
    l.eventBus.Publish("user.updated", UserUpdatedEvent{
        UserId: req.UserId,
        Name:   req.Name,
        Email:  req.Email,
    })
    
    return nil
}
```

### 13.4 ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

#### âœ… å¿…é ˆäº‹é …
- **Foreign Keyåˆ¶ç´„ã¯ã‚µãƒ¼ãƒ“ã‚¹å†…ã®ã¿**ï¼š`user_profiles.user_id`ã¯`winyx_core.users.id`ã‚’å‚ç…§
- **Cross-DBå‚ç…§ã¯é¿ã‘ã‚‹**ï¼šTaskServiceã‹ã‚‰ç›´æ¥`winyx_core.users`ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’JOINã—ãªã„
- **APIå‘¼ã³å‡ºã—ã§ãƒ‡ãƒ¼ã‚¿è£œå®Œ**ï¼šå¿…è¦ã«å¿œã˜ã¦UserServiceã®APIã‹ã‚‰æƒ…å ±å–å¾—

#### âŒ ç¦æ­¢äº‹é …
- **ç›´æ¥çš„ãªCross-DB JOIN**ï¼š`winyx_task.tasks JOIN winyx_core.users`
- **è¤‡æ•°DBã«ã¾ãŸãŒã‚‹ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³**ï¼šåˆ†æ•£ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³ã¯è¤‡é›‘åŒ–ã®åŸå› 
- **ã‚µãƒ¼ãƒ“ã‚¹å¢ƒç•Œã‚’è¶ŠãˆãŸForeign Key**ï¼šç•°ãªã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ†ãƒ¼ãƒ–ãƒ«é–“ã§ã®FKè¨­å®š

### 13.5 å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ä¾‹

#### GoZeroè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```yaml
# UserServiceè¨­å®šä¾‹
Name: user_service
Mysql:
  DataSource: "winyx:Winyx&7377@tcp(127.0.0.1:3306)/winyx_core?charset=utf8mb4&parseTime=true"

# TaskServiceè¨­å®šä¾‹  
Name: task_service
Mysql:
  DataSource: "winyx:Winyx&7377@tcp(127.0.0.1:3306)/winyx_task?charset=utf8mb4&parseTime=true"
```

#### ã‚µãƒ¼ãƒ“ã‚¹é–“ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ
```go
// internal/clients/userserviceclient.go
type UserServiceClient struct {
    baseURL string
    client  *http.Client
}

func (c *UserServiceClient) GetUser(ctx context.Context, userID int64) (*User, error) {
    url := fmt.Sprintf("%s/api/v1/users/%d", c.baseURL, userID)
    req, err := http.NewRequestWithContext(ctx, "GET", url, nil)
    if err != nil {
        return nil, err
    }
    
    // JWTèªè¨¼ãƒ˜ãƒƒãƒ€ãƒ¼è¿½åŠ 
    req.Header.Set("Authorization", "Bearer "+c.getServiceToken())
    
    resp, err := c.client.Do(req)
    if err != nil {
        return nil, fmt.Errorf("user service call failed: %w", err)
    }
    defer resp.Body.Close()
    
    var result struct {
        User User `json:"user"`
    }
    if err := json.NewDecoder(resp.Body).Decode(&result); err != nil {
        return nil, err
    }
    
    return &result.User, nil
}
```

### 13.6 è©³ç´°ä»•æ§˜å‚ç…§
ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹é–“ã®è©³ç´°ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæˆ¦ç•¥ã¯ä»¥ä¸‹ã‚’å‚ç…§ï¼š
ğŸ“„ **`docs/ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹_ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆæˆ¦ç•¥.md`**

- Database per Serviceãƒ‘ã‚¿ãƒ¼ãƒ³ã®è©³ç´°
- å„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ã‚¹ã‚­ãƒ¼ãƒè¨­è¨ˆ
- Sagaãƒ‘ã‚¿ãƒ¼ãƒ³ã«ã‚ˆã‚‹ãƒ‡ãƒ¼ã‚¿æ•´åˆæ€§ä¿è¨¼
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
- ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æˆ¦ç•¥

---

## ä»˜éŒ²Aï¼švim ç½®æ›ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ

- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸€æ‹¬ç½®æ›ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å†…ï¼‰

```vim
:%s/testapi_api\.yaml/test_api-api.yaml/g
```

- [ ] ç« ç•ªå·ã®ç½®æ›ä¾‹

```vim
:%s/^1\.6 /2.1.6 /g
```

---

### ä»¥ä¸Š